<template lang="pug">
#container
  img(src='~static/img/musicalbum/romanticbeach/bg.jpg', style='height:815px;position:absolute;left:0')
  #haiquan
    img#jiushengying(src='~static/img/musicalbum/romanticbeach/jiushengying.png')
    img#jiusheng(src='~static/img/musicalbum/romanticbeach/jiusheng.png')
  #jijuxieying(style='top:640px;left:54px')
    .leg1(style='width:19px;height:30px;left:70px;top:-10px')
      img.leg11(src='~static/img/musicalbum/romanticbeach/1a.png')
      .leg1-1(style='position:absolute;width:53px;height:26px;left:-40px;top:-18px')
        img.leg12(src='~static/img/musicalbum/romanticbeach/4a.png')
        img.leg13(src='~static/img/musicalbum/romanticbeach/0a.png', style='position:absolute;left:-33px;top:1px')
    .leg2(style='width:35px;height:44px;left:79px;top:-18px')
      img.leg21(src='~static/img/musicalbum/romanticbeach/9a.png')
      img.leg22(src='~static/img/musicalbum/romanticbeach/2a.png', style='position:absolute;left:7px;top:-34px')
    img.leg3(style='left:86px;top:1px', src='~static/img/musicalbum/romanticbeach/3a.png')
    img.leg4(style='left:91px;top:43px', src='~static/img/musicalbum/romanticbeach/10a.png')
    .leg5(style='width:53px;height:26px;left:76px;top:52px')
      img.leg51(style='position:absolute;-webkit-transform:scale(.81,.6) rotate(27.3deg)', src='~static/img/musicalbum/romanticbeach/4a.png')
      .leg5-1(style='position:absolute;width:14px;height:52px;left:28px;top:13px')
        img.leg52(src='~static/img/musicalbum/romanticbeach/7a.png')
        img.leg53(src='~static/img/musicalbum/romanticbeach/8a.png', style='position:absolute;left:-10px;top:44px')
    .leg6(style='width:35px;height:44px;left:72px;top:49px')
      img.leg61(style='position:absolute;-webkit-transform:translate(-10px,-12px) rotate(3.8deg) scale(1,-1)', src='~static/img/musicalbum/romanticbeach/9a.png')
      .leg6-1(style='position:absolute;width:14px;height:52px;left:10px;top:16px')
        img.leg62(style='position:absolute;-webkit-transform:rotate(26.3deg)', src='~static/img/musicalbum/romanticbeach/7a.png')
        img.leg63(style='position:absolute;left:-12px;top:36px;-webkit-transform-origin:25% 25%', src='~static/img/musicalbum/romanticbeach/8a.png')
    img.tou(src='~static/img/musicalbum/romanticbeach/5a.png')
    img.ke(src='~static/img/musicalbum/romanticbeach/11a.png')
  #jijuxie
    .leg1(style='width:19px;height:30px;left:70px;top:-10px')
      img.leg11(src='~static/img/musicalbum/romanticbeach/1.png')
      .leg1-1(style='position:absolute;width:53px;height:26px;left:-40px;top:-18px')
        img.leg12(src='~static/img/musicalbum/romanticbeach/4.png')
        img.leg13(src='~static/img/musicalbum/romanticbeach/0.png', style='position:absolute;left:-33px;top:1px')
    .leg2(style='width:35px;height:44px;left:79px;top:-18px')
      img.leg21(src='~static/img/musicalbum/romanticbeach/9.png')
      img.leg22(src='~static/img/musicalbum/romanticbeach/2.png', style='position:absolute;left:7px;top:-34px')
    img.leg3(style='left:86px;top:1px', src='~static/img/musicalbum/romanticbeach/3.png')
    img.leg4(style='left:91px;top:43px', src='~static/img/musicalbum/romanticbeach/10.png')
    .leg5(style='width:53px;height:26px;left:76px;top:52px')
      img.leg51(style='position:absolute;-webkit-transform:scale(.81,.6) rotate(27.3deg)', src='~static/img/musicalbum/romanticbeach/4.png')
      .leg5-1(style='position:absolute;width:14px;height:52px;left:28px;top:13px')
        img.leg52(src='~static/img/musicalbum/romanticbeach/7.png')
        img.leg53(src='~static/img/musicalbum/romanticbeach/8.png', style='position:absolute;left:-10px;top:44px')
    .leg6(style='width:35px;height:44px;left:72px;top:49px')
      img.leg61(style='position:absolute;-webkit-transform:translate(-10px,-12px) rotate(3.8deg) scale(1,-1)', src='~static/img/musicalbum/romanticbeach/9.png')
      .leg6-1(style='position:absolute;width:14px;height:52px;left:10px;top:16px')
        img.leg62(style='position:absolute;-webkit-transform:rotate(26.3deg)', src='~static/img/musicalbum/romanticbeach/7.png')
        img.leg63(style='position:absolute;left:-12px;top:36px;-webkit-transform-origin:25% 25%', src='~static/img/musicalbum/romanticbeach/8.png')
    img.tou(src='~static/img/musicalbum/romanticbeach/5.png')
    img.ke(src='~static/img/musicalbum/romanticbeach/11.png')
  #page_v1.kuang
    #ying_v1.ying
      img(src='~static/img/musicalbum/romanticbeach/ying.png')
    #kuangimg_v1.kuangimg
      img(src='~static/img/musicalbum/romanticbeach/kuang.png')
      div(style='position:absolute;top:15px;left:15px;width:255px;height:347px;overflow:hidden')
        img#img_v1(style='position:absolute')
  #page_h1.kuang
    #ying_h1.ying
      img(src='~static/img/musicalbum/romanticbeach/ying.png', style='-webkit-transform:rotate(90deg)')
    #kuangimg_h1.kuangimg
      img(src='~static/img/musicalbum/romanticbeach/kuang.png', style='-webkit-transform:rotate(90deg)')
      div(style='position:absolute;top:61px;left:-31px;width:347px;height:255px;overflow:hidden')
        img#img_h1(style='position:absolute')
  #page_v2.kuang1
    #ying_v2.ying
      img(src='~static/img/musicalbum/romanticbeach/ying.png')
    #kuangimg_v2.kuangimg
      img(src='~static/img/musicalbum/romanticbeach/kuang.png')
      div(style='position:absolute;top:15px;left:15px;width:255px;height:347px;overflow:hidden')
        img#img_v2(style='position:absolute')
  #page_h2.kuang1
    #ying_h2.ying
      img(src='~static/img/musicalbum/romanticbeach/ying.png', style='-webkit-transform:rotate(90deg)')
    #kuangimg_h2.kuangimg
      img(src='~static/img/musicalbum/romanticbeach/kuang.png', style='-webkit-transform:rotate(90deg)')
      div(style='position:absolute;top:61px;left:-31px;width:347px;height:255px;overflow:hidden')
        img#img_h2(style='position:absolute')
  #page_v3.kuang
    #ying_v3.ying
      img(src='~static/img/musicalbum/romanticbeach/ying.png')
    #kuangimg_v3.kuangimg
      img(src='~static/img/musicalbum/romanticbeach/kuang.png')
      div(style='position:absolute;top:15px;left:15px;width:255px;height:347px;overflow:hidden')
        img#img_v3(style='position:absolute')
  #page_h3.kuang
    #ying_h3.ying
      img(src='~static/img/musicalbum/romanticbeach/ying.png', style='-webkit-transform:rotate(90deg)')
    #kuangimg_h3.kuangimg
      img(src='~static/img/musicalbum/romanticbeach/kuang.png', style='-webkit-transform:rotate(90deg)')
      div(style='position:absolute;top:61px;left:-31px;width:347px;height:255px;overflow:hidden')
        img#img_h3(style='position:absolute')
  #page_v4.kuang1
    #ying_v4.ying
      img(src='~static/img/musicalbum/romanticbeach/ying.png')
    #kuangimg_v4.kuangimg
      img(src='~static/img/musicalbum/romanticbeach/kuang.png')
      div(style='position:absolute;top:15px;left:15px;width:255px;height:347px;overflow:hidden')
        img#img_v4(style='position:absolute')
  #page_h4.kuang1
    #ying_h4.ying
      img(src='~static/img/musicalbum/romanticbeach/ying.png', style='-webkit-transform:rotate(90deg)')
    #kuangimg_h4.kuangimg
      img(src='~static/img/musicalbum/romanticbeach/kuang.png', style='-webkit-transform:rotate(90deg)')
      div(style='position:absolute;top:61px;left:-31px;width:347px;height:255px;overflow:hidden')
        img#img_h4(style='position:absolute')
  #pagetitle.page-title
    div(style="position:absolute;width:410px;height:200px;top:0;left:0;overflow:hidden")
      div(style="position:absolute;width:410px;height:200px;display:table;overflow:hidden")
        .title-content {{titleText}}
</template>

<script>
  export default {
    data () {
      return {
      pageTimer: [] }
    },
    methods:{
      clearPageTimer(){
        for (var i = 0; i < this.pageTimer.length; i++) {
          clearTimeout(this.pageTimer[i])
        }
      }
    },
    mounted () {
      document.ontouchmove = function(e) {
          e.preventDefault();
      };
      var module_inits = [];

      var upload_permission = false;

      var _this = this
      function load_init_modules() {
          for (var i = 0; i < module_inits.length; i++) {
              module_inits[i]();
          }
      }

      function call_me(fun) {
          module_inits.push(fun);
      }

      var image_size_width = [];
      var image_size_height = [];
      var Onload_imgs_url  = [];
      var slider_images_url  = this.imageList
      var image_url_index = 0;
      var have_num = 0;
      var error_num = 0;
      var canshow = true;
      var reshow = false;
      var begin_titletime  = new Date().getTime()
      var delaytime = 4000;

      function id(name) {
          return document.getElementById(name);
      }

      function load_images() {
          reshow = false;
          image_size_width = [];
          image_size_height = [];
          Onload_imgs_url = [];

          image_url_index = 0;
          have_num = 0;
          error_num = 0;

          begin_titletime = new Date();
          begin_titletime = begin_titletime.getTime();
          showtitle();

          id('page_v1').style.webkitAnimation = '';
          id('ying_v1').style.webkitAnimation = '';
          id('kuangimg_v1').style.webkitAnimation = '';
          id('page_v2').style.webkitAnimation = '';
          id('ying_v2').style.webkitAnimation = '';
          id('kuangimg_v2').style.webkitAnimation = '';
          id('page_h1').style.webkitAnimation = '';
          id('ying_h1').style.webkitAnimation = '';
          id('kuangimg_h1').style.webkitAnimation = '';
          id('page_h2').style.webkitAnimation = '';
          id('ying_h2').style.webkitAnimation = '';
          id('kuangimg_h2').style.webkitAnimation = '';
          id('page_v1').style.display = 'none';
          id('page_v2').style.display = 'none';
          id('page_h1').style.display = 'none';
          id('page_h2').style.display = 'none';

          canshow = true;

          for (var i = 0; i < slider_images_url.length; i++) {
              var img = new Image();
              img.index = i;
              // console.log(i);
              img.src = slider_images_url[i];
              Onload_imgs_url[i] = 'loading';
              img.onload = image_onload;
              img.onerror = image_onerror;
          }
      }

      function image_onerror(event) {
          var img = event.target;
          var index = img.index;
          if (index < 10)
              error_num++;
          Onload_imgs_url[index] = 'not find';
          // console.log(Onload_imgs_url[index]);
          // console.log(have_num + '-' + error_num);
          if ((have_num + error_num >= 10 || slider_images_url.length == (have_num + error_num)) && canshow == true) {
              reshow = false;
              canshow = false;
              if (have_num == 0)
                  return;

              var end_titletime = new Date();
              end_titletime = end_titletime.getTime();
              var dis_titletime = Math.abs(end_titletime - begin_titletime);
              if (dis_titletime > delaytime) {
                  distitle();
              } else {
                  dis_titletime = delaytime - dis_titletime;
                  _this.pageTimer['timeout0'] = setTimeout(function() {
                      distitle();
                  }, dis_titletime);
              }
          }
      }

      function image_onload(event) {
          if (reshow == true)
              return;

          var img = event.target;
          var index = img.index;
          if (index < 10)
              have_num++;
          Onload_imgs_url[index] = img.src;
          image_size_width[index] = img.width;
          image_size_height[index] = img.height;

          if ((have_num + error_num >= 10 || slider_images_url.length == (have_num + error_num)) && canshow == true) {
              reshow = false;
              canshow = false;
              if (have_num == 0)
                  return;

              var end_titletime = new Date();
              end_titletime = end_titletime.getTime();
              var dis_titletime = Math.abs(end_titletime - begin_titletime);
              if (dis_titletime > delaytime) {
                  distitle();
              } else {
                  dis_titletime = delaytime - dis_titletime;
                  _this.pageTimer['timeout0'] = setTimeout(function() {
                      distitle();
                  }, dis_titletime);
              }
          }
      }

      function showtitle() {
          id('pagetitle').style.webkitAnimation = 'aa_in_fade_right 1s ease-out both';
      }

      function distitle() {
          id('pagetitle').style.webkitAnimation = 'aa_out_fade_right 1s ease-in both';
          begin_show();
      }

      function begin_show() {
          if (reshow == true)
              return;
          if (image_url_index == Onload_imgs_url.length)
              image_url_index = 0;
          cut_image(1);
          image_url_index++;
          _this.pageTimer['timeout1'] = setTimeout(next_show_3, 6000);
      }

      function next_show() {
          if (reshow == true)
              return;

          if (image_url_index == Onload_imgs_url.length)
              image_url_index = 0;
          cut_image(2);
          image_url_index++;
          _this.pageTimer['timeout2'] = setTimeout(begin_show, 6000);
      }

      function next_show_2() {
          if (reshow == true)
              return;

          if (image_url_index == Onload_imgs_url.length)
              image_url_index = 0;
          cut_image(3);
          image_url_index++;
          _this.pageTimer['timeout2'] = setTimeout(next_show_4, 6000);
      }

      function next_show_3() {
          if (reshow == true)
              return;
          if (image_url_index == Onload_imgs_url.length)
              image_url_index = 0;
          cut_image(4);
          image_url_index++;
          _this.pageTimer['timeout2'] = setTimeout(next_show, 6000);
      }

      function cut_image(pageindex) {
          if (reshow == true)
              return;
          while (Onload_imgs_url[image_url_index] == 'not find' || Onload_imgs_url[image_url_index] == 'loading') {
              // console.log(Onload_imgs_url[image_url_index]);
              image_url_index++;
              if (image_url_index == Onload_imgs_url.length)
                  image_url_index = 0;
          }
          var img_bili = image_size_width[image_url_index] / image_size_height[image_url_index];
          id('page_h' + pageindex).style.display = 'none';
          id('page_v' + pageindex).style.display = 'none';
          id('page_h' + pageindex).style.webkitAnimation = '';
          id('ying_h' + pageindex).style.webkitAnimation = '';
          id('kuangimg_h' + pageindex).style.webkitAnimation = '';
          id('page_v' + pageindex).style.webkitAnimation = '';
          id('ying_v' + pageindex).style.webkitAnimation = '';
          id('kuangimg_v' + pageindex).style.webkitAnimation = '';
          if (img_bili > 1) { //横版h
              var img_obj = id('img_h' + pageindex);
              img_obj.src = Onload_imgs_url[image_url_index];

              if (img_bili > (347 / 255)) {
                  img_obj.style.height = '255px';
                  img_obj.style.width = img_bili * 255 + 'px';
                  img_obj.style.top = '0px';
                  img_obj.style.left = -((img_bili * 255 - 347) / 2) + 'px';
              } else {
                  img_obj.style.width = '347px';
                  img_obj.style.height = 347 / img_bili + 'px';
                  img_obj.style.left = '0px';
                  img_obj.style.top = -((347 / img_bili - 255) / 2) + 'px';
              }
              _this.pageTimer['timeout3'] = setTimeout(function() {
                  // console.log(image_url_index, pageindex, 'h');

                  if (pageindex == 1)
                      id('page_h' + pageindex).style.webkitAnimation = 'kuangmove 10s linear both';
                  else if (pageindex == 3)
                      id('page_h' + pageindex).style.webkitAnimation = 'kuangmove2 10s linear both';
                  else if (pageindex == 4)
                      id('page_h' + pageindex).style.webkitAnimation = 'kuangmove3 10s linear both';
                  else
                      id('page_h' + pageindex).style.webkitAnimation = 'kuangmove1 10s linear both';
                  id('page_h' + pageindex).style.display = 'block';
                  id('ying_h' + pageindex).style.webkitAnimation = 'yingmove 10s linear both';
                  id('kuangimg_h' + pageindex).style.webkitAnimation = 'kuang 10s linear both';
                  id('page_v' + pageindex).style.display = 'none';
                  id('page_h' + pageindex).style.display = 'block';
              }, 100);
          } else { //竖版v {

              var img_obj = id("img_v" + pageindex);
              img_obj.src = Onload_imgs_url[image_url_index];

              if (img_bili > (255 / 347)) {
                  img_obj.style.height = '347px';
                  img_obj.style.width = img_bili * 347 + 'px';
                  img_obj.style.top = '0px';
                  img_obj.style.left = -(img_bili * 347 - 255) / 2 + 'px';
              } else {
                  img_obj.style.width = '255px';
                  img_obj.style.height = 255 / img_bili + 'px';
                  img_obj.style.left = '0px';
                  img_obj.style.top = -(255 / img_bili - 347) / 2 + 'px';
              }
              _this.pageTimer['timeout4'] = setTimeout(function() {
                  // console.log(image_url_index, pageindex, 'v');

                  if (pageindex == 1)
                      id('page_v' + pageindex).style.webkitAnimation = 'kuangmove 8s linear both';
                  else
                      id('page_v' + pageindex).style.webkitAnimation = 'kuangmove1 8s linear both';
                  id('page_v' + pageindex).style.display = 'block';
                  id('ying_v' + pageindex).style.webkitAnimation = 'yingmove 8s linear both';
                  id('kuangimg_v' + pageindex).style.webkitAnimation = 'kuang 8s linear both';
                  id('page_v' + pageindex).style.display = 'block';
                  id('page_h' + pageindex).style.display = 'none';

              }, 100);
          }
      }
      call_me(load_images);

      function reload_scene() {
          reshow = true;
          id('titlecontent').innerHTML = '';
          id('pagetitle').style.webkitAnimation = '';
          setTimeout(load_images, 100);
      }
      load_init_modules()
    },
    props: {
      titleText: {
        default: '测试标题',
        type: String
      },
      imageList: {
        type: Array,
        default: []
      }
    },
    destroyed(){
      this.clearPageTimer()
    }
  }
</script>

<style scoped>
@import '~static/css/musicalbum/animate2.css';
@import '~static/css/musicalbum/romanticbeach.css';
img{
  width: auto;
}
</style>
